断点续传的相关数据由服务器维护。在传输数据时，数据未传输完成之前，均存放在临时文件中。

#### 服务端

服务器接受到新登陆用户后，会在下表中查找对应用户上传文件的断点续传信息，然后将信息发送给用户，由用户决定是否需要恢复上传，如果拒绝，则删除对应文件。

###### 临时文件表

| 字段             | 类型 | 说明                            |
| ---------------- | ---- | ------------------------------- |
| id               | int  | 主键                            |
| email            | text | 用户邮箱                        |
| tmp_path         | text | 临时文件路径                    |
| unused_trunk_ids | text | 未传输的文件块编号(使用`;`分割) |
| name             | text | 文件名                          |
| parent_id        | int  | 目录 id                         |
| full_path        | text | 文件完整路径                    |

客户端掉线后，如果当前有未结束的传输任务，则将传输的相关数据写入该表。

#### 实现流程

客户端登陆后，发送请求

```json
{
  "req": "bp_continue"
}
```

服务端响应

```json
{
  "resp": "bp_continue",
  "data": [
    {
      "path": "",
      "id": 0 // fileblob 的 id
    }
  ]
}
```

如果客户端选择断线重连，那么还需请求文件未传输完成的文件块列表

```json
{
  "req": "unused_trunk_ids",
  "data": {
    "id": 0 // fileblob 的 id
  }
}
```

服务端响应

```json
{
  "resp": "unused_trunk_ids",
  "data": {
    "id": 0,
    "turnks": "" // 使用';'分割的编号列表
  }
}
```

然后进入正常的上传下载流程。
